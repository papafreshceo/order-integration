<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì£¼ë¬¸í†µí•© ì‹œìŠ¤í…œ</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    
    <!-- CSS íŒŒì¼ë“¤ -->
    <link rel="stylesheet" href="styles.css">
    
    <style>
        /* ì´ˆê¸° ë¡œë”© í™”ë©´ */
        .initial-loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #ffffff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 99999;
        }
        
        .initial-loading.hide {
            display: none;
        }
        
        .initial-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #2563eb;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        .initial-text {
            margin-top: 20px;
            color: #6c757d;
            font-size: 14px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ì´ˆê¸°ì— ëª¨ë“  ì£¼ìš” ì»¨í…Œì´ë„ˆ ìˆ¨ê¹€ */
        .login-wrapper,
        .main-system {
            display: none;
        }
    </style>
</head>
<body>
    <!-- ì´ˆê¸° ë¡œë”© í™”ë©´ -->
    <div class="initial-loading" id="initialLoading">
        <div class="initial-spinner"></div>
        <div class="initial-text">ì‹œìŠ¤í…œ ë¡œë”© ì¤‘...</div>
    </div>

    <!-- ë¡œê·¸ì¸ í™”ë©´ -->
    <div class="login-wrapper" id="loginScreen" style="display: none;">
        <div class="login-card">
            <h1 class="login-title">ì£¼ë¬¸í†µí•© ì‹œìŠ¤í…œ</h1>
            <p class="login-subtitle">ë¡œê·¸ì¸í•˜ì—¬ ì‹œì‘í•˜ì„¸ìš”</p>
            
            <div class="error-message" id="errorMsg"></div>
            
            <div class="form-group">
                <label class="form-label">ì´ë©”ì¼</label>
                <input type="email" id="email" class="form-input" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”" onkeypress="handleEnter(event)">
            </div>
            
            <div class="form-group">
                <label class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="password" class="form-input" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" onkeypress="handleEnter(event)">
            </div>
            
            <button class="btn-login" onclick="signInWithEmail(event)">ë¡œê·¸ì¸</button>
            
            <div class="divider">
                <span>ë˜ëŠ”</span>
            </div>
            
            <button class="btn-google" onclick="signInWithGoogle(event)">
                <span class="google-icon">G</span>
                Googleë¡œ ë¡œê·¸ì¸
            </button>
            
            <div class="auth-footer">
                <span>ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? </span>
                <a href="#" class="auth-link" onclick="showSignUp(); return false;">íšŒì›ê°€ì…</a>
            </div>
        </div>
        
        <!-- íšŒì›ê°€ì… ì¹´ë“œ -->
        <div class="login-card" id="signupCard" style="display: none;">
            <h1 class="login-title">íšŒì›ê°€ì…</h1>
            <p class="login-subtitle">ìƒˆ ê³„ì •ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”</p>
            
            <div class="error-message" id="signupErrorMsg"></div>
            
            <div class="form-group">
                <label class="form-label">ì´ë¦„</label>
                <input type="text" id="signupName" class="form-input" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            
            <div class="form-group">
                <label class="form-label">ì´ë©”ì¼</label>
                <input type="email" id="signupEmail" class="form-input" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            
            <div class="form-group">
                <label class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="signupPassword" class="form-input" placeholder="6ì ì´ìƒì˜ ë¹„ë°€ë²ˆí˜¸">
            </div>
            
            <button class="btn-login" onclick="signUp(event)">ê³„ì • ë§Œë“¤ê¸°</button>
            
            <div class="auth-footer">
                <span>ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? </span>
                <a href="#" class="auth-link" onclick="showLogin(); return false;">ë¡œê·¸ì¸</a>
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ ì‹œìŠ¤í…œ -->
    <div class="main-system" id="mainSystem" style="display: none;">
        <div class="header">
            <h1>ğŸ“¦ ì£¼ë¬¸í†µí•© ì‹œìŠ¤í…œ</h1>
            <div class="user-info">
                <span id="userEmail">user@example.com</span>
                <span class="role-badge" id="userRole">ì§ì›</span>
                <button class="btn-logout" onclick="signOut(event)">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>

        <div class="tabs">
            <div class="tab-menu" id="tabMenu"></div>
        </div>

        <div class="container">
            <!-- ëŒ€ì‹œë³´ë“œ íƒ­ -->
            <div id="dashboard" class="tab-content">
                <h2>ëŒ€ì‹œë³´ë“œ</h2>
                <div class="stats-grid" id="dashboardStats"></div>
                
                <div class="dashboard-section">
                    <h3 class="section-subtitle">ìµœê·¼ ì£¼ë¬¸ í˜„í™©</h3>
                    <p class="loading" id="dashboardLoading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                    <table id="dashboardSummaryTable" style="display: none;">
                        <thead>
                            <tr>
                                <th>ë‚ ì§œ</th>
                                <th>ì£¼ë¬¸ë²ˆí˜¸</th>
                                <th>ê³ ê°ëª…</th>
                                <th>ìƒí’ˆëª…</th>
                                <th>ìƒíƒœ</th>
                            </tr>
                        </thead>
                        <tbody id="dashboardSummaryBody"></tbody>
                    </table>
                </div>

                <div class="dashboard-section">
                    <h3 class="section-subtitle">ë¹ ë¥¸ ì‘ì—…</h3>
                    <div class="quick-actions">
                        <button class="btn" onclick="showTab('realtime')">ì‹¤ì‹œê°„ ì£¼ë¬¸ í™•ì¸</button>
                        <button class="btn" onclick="refreshCurrentTab(event)">ìƒˆë¡œê³ ì¹¨</button>
                    </div>
                </div>
            </div>

            <!-- ì‹¤ì‹œê°„ ì£¼ë¬¸í˜„í™© íƒ­ -->
            <div id="realtime" class="tab-content">
                <h2>ì‹¤ì‹œê°„ ì£¼ë¬¸í˜„í™©</h2>
                
                <div class="refresh-section">
                    <button class="btn-refresh" onclick="refreshRealtimeData(event)">â†» ìƒˆë¡œê³ ì¹¨</button>
                    <div class="refresh-info">
                        ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: <span id="lastUpdateTime">-</span>
                    </div>
                </div>

                <div class="stats-grid" id="statsGrid"></div>
                
                <p class="loading" id="realtimeLoading">ì£¼ë¬¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                
                <table id="realtimeTable" style="display: none;">
                    <thead id="realtimeHead"></thead>
                    <tbody id="realtimeBody"></tbody>
                </table>
            </div>

            <!-- ì£¼ë¬¸ì¡°íšŒ íƒ­ -->
            <div id="search" class="tab-content">
                <h2>ì£¼ë¬¸ì¡°íšŒ</h2>
                <div class="search-box">
                    <input type="date" id="startDate" class="date-input">
                    <span>~</span>
                    <input type="date" id="endDate" class="date-input">
                    <button class="btn" onclick="searchOrders()">ì¡°íšŒ</button>
                </div>
                <div id="searchResult"></div>
            </div>

            <!-- ì£¼ë¬¸í†µí•©(Excel) íƒ­ -->
            <div id="excel" class="tab-content">
                <h2>ì£¼ë¬¸í†µí•©(Excel)</h2>
                <div class="upload-area" onclick="document.getElementById('excelFile').click()">
                    <div class="upload-icon">ğŸ“</div>
                    <p>íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë˜ê·¸í•´ì£¼ì„¸ìš”</p>
                    <input type="file" id="excelFile" style="display: none;" accept=".xlsx,.xls,.csv" multiple>
                </div>
                <button class="btn" onclick="processExcel()">ì²˜ë¦¬í•˜ê¸°</button>
                <div id="excelResult"></div>
            </div>

            <!-- ì†¡ì¥ë“±ë¡ íƒ­ -->
            <div id="invoice" class="tab-content">
                <h2>ì†¡ì¥ë“±ë¡</h2>
                <div class="form-container">
                    <div class="form-row">
                        <label>ì£¼ë¬¸ë²ˆí˜¸</label>
                        <input type="text" id="orderNo" class="form-input">
                    </div>
                    <div class="form-row">
                        <label>ì†¡ì¥ë²ˆí˜¸</label>
                        <input type="text" id="invoiceNo" class="form-input">
                    </div>
                    <div class="form-row">
                        <label>íƒë°°ì‚¬</label>
                        <select id="courier" class="form-select">
                            <option>CJëŒ€í•œí†µìš´</option>
                            <option>í•œì§„íƒë°°</option>
                            <option>ë¡¯ë°íƒë°°</option>
                            <option>ìš°ì²´êµ­íƒë°°</option>
                        </select>
                    </div>
                    <button class="btn" onclick="registerInvoice()">ë“±ë¡</button>
                </div>
                <div id="invoiceResult"></div>
            </div>

            <!-- í†µê³„ ë¶„ì„ íƒ­ -->
            <div id="analytics" class="tab-content">
                <h2>í†µê³„ ë¶„ì„</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">ì´ë²ˆ ë‹¬ ë§¤ì¶œ</div>
                        <div class="stat-value">â‚©12,450,000</div>
                        <div class="stat-change positive">â–² +23%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">ì´ë²ˆ ë‹¬ ì£¼ë¬¸</div>
                        <div class="stat-value">1,234</div>
                        <div class="stat-change positive">â–² +15%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">í‰ê·  ì£¼ë¬¸ê¸ˆì•¡</div>
                        <div class="stat-value">â‚©45,000</div>
                        <div class="stat-change negative">â–¼ -5%</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript íŒŒì¼ë“¤ (ìˆœì„œ ì¤‘ìš”!) -->
    <script src="firebase-config.js"></script>
    <script src="utils.js"></script>
    
    <!-- Config -->
    <script src="js/config/menu-config.js"></script>
    <script src="js/config/stats-config.js"></script>
    
    <!-- Modules -->
    <script src="js/modules/dashboard.js"></script>
    <script src="js/modules/realtime.js"></script>
    <script src="js/modules/search.js"></script>
    <script src="js/modules/excel.js"></script>
    <script src="js/modules/invoice.js"></script>
    <script src="js/modules/analytics.js"></script>
    <script src="js/modules/coupang-sync.js"></script>
    
    <!-- Core -->
    <script src="js/core/tab-manager.js"></script>
    <script src="js/core/auto-refresh.js"></script>
    
    <!-- Main -->
    <script src="auth.js"></script>
    <script src="app.js"></script>
    
    <script>
        // ì´ˆê¸° ë¡œë”© ì²˜ë¦¬
        let authInitialized = false;
        
        // DOMì´ ë¡œë“œëœ í›„ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            // ì´ˆê¸° ë¡œë”© í™”ë©´ ìš”ì†Œ í™•ì¸
            const initialLoading = document.getElementById('initialLoading');
            const loginScreen = document.getElementById('loginScreen');
            const mainSystem = document.getElementById('mainSystem');
            
            // Firebase Auth ì´ˆê¸°í™” í™•ì¸
            if (typeof auth !== 'undefined') {
                auth.onAuthStateChanged(async (user) => {
                    if (!authInitialized) {
                        authInitialized = true;
                        
                        // ì´ˆê¸° ë¡œë”© í™”ë©´ ìˆ¨ê¸°ê¸°
                        setTimeout(() => {
                            if (initialLoading) {
                                initialLoading.classList.add('hide');
                            }
                            
                            if (user) {
                                // ë¡œê·¸ì¸ ìƒíƒœ - ë©”ì¸ í™”ë©´ í‘œì‹œ
                                if (loginScreen) loginScreen.style.display = 'none';
                                if (mainSystem) mainSystem.style.display = 'block';
                            } else {
                                // ë¹„ë¡œê·¸ì¸ ìƒíƒœ - ë¡œê·¸ì¸ í™”ë©´ í‘œì‹œ
                                if (loginScreen) loginScreen.style.display = 'flex';
                                if (mainSystem) mainSystem.style.display = 'none';
                            }
                        }, 500);
                    }
                });
            } else {
                // Firebase ë¡œë“œ ì‹¤íŒ¨ ì‹œ
                setTimeout(() => {
                    if (initialLoading) {
                        initialLoading.classList.add('hide');
                    }
                    if (loginScreen) {
                        loginScreen.style.display = 'flex';
                    }
                }, 1000);
            }
        });
    </script>
</body>
</html>
